<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{channel.displayName}} - Stamp.tv</title>
</head>
<body>
<div class="channel">
    <h1>{{channel.displayName}}</h1>
</div>
<div class="media"></div>
<div class="chat">
    <div class="messages"></div>
    <div class="message-box">
        <input type="text" placeholder="message...">
        <a href="#" onclick="return false;">Send</a>
    </div>
</div>
<script src="/public/javascript/feature-chat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/socket.io-client@2/dist/socket.io.js"></script>
<script>
    createLogElement("Connecting to the chat room of " + "{{channel.username}}");

    let socket = io.connect("192.168.1.160:4002", {query: "channel={{channel.username}}&user={{user.displayName}}"});

    socket.on("connect", () => {
        createLogElement("Connected!");
    });

    socket.on("error", (err) => {
        createLogElement("Disconnected from the chat room");
    });

    socket.on("chat-message", (data) => {
        createMessageElement(data.message, data.user);
    });

    document.querySelector(".message-box a").addEventListener("mouseup", e => {
        sendMessage();
    });
    document.querySelector(".message-box").addEventListener("keyup", e => {
        if (e.key.toString() === "Enter")
            sendMessage();
    });

    //socket.on("debug", (data) => {
    //    document.querySelector(".chat").append("<pre>" + data + "</pre>");
    //});
</script>
</body>
</html>