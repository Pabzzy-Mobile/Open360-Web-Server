<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{channel.displayName}} - Open360</title>
</head>
<body>
{% include "includes/header.html" %}
<div class="channel">
    <h1>{{channel.displayName}}</h1>
</div>
<div class="media"></div>
<div class="chat">
    <div class="messages"></div>
    {% if user %}
    <div class="message-box">
        <input type="text" placeholder="message...">
        <a href="#" onclick="return false;">Send</a>
    </div>
    {% else %}
    <div class="message-box">
        <p>You need to be logged in to message in {{channel.username}}'s chat</p>
    </div>
    {% endif %}
</div>
<script src="/public/javascript/feature-chat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/socket.io-client@2/dist/socket.io.js"></script>
<script>
    createLogElement("Connecting to the chat room of " + "{{channel.username}}");
    //{% if user %}
    let socket = io.connect("192.168.1.160:4002", {query: "channel={{channel.username}}&user={{user.displayName}}"});
    //{% else %}
    let socket = io.connect("192.168.1.160:4002", {query: "channel={{channel.username}}"});
    //{% endif %}
    socket.on("connect", () => {
        createLogElement("Connected!");
    });

    socket.on("error", (err) => {
        createLogElement("Disconnected from the chat room");
    });

    socket.on("chat-message", (data) => {
        createMessage(data.message, data.user);
    });
    //{% if user %}
    document.querySelector(".message-box a").addEventListener("mouseup", e => {
        sendMessage();
    });
    document.querySelector(".message-box").addEventListener("keyup", e => {
        if (e.key.toString() === "Enter")
            sendMessage();
    });
    //{% endif %}
</script>
</body>
</html>